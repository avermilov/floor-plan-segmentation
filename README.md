# Floor Plan Segmentation
Улучшенный фреймворк, основанный на Deep Floor Plan Recognition (2020), для высококачественной сегментации планировок квартир с небольшим объемом тренировочных данных.

### Задача
Фреймворк решает задачу многоклассовой семантической сегментации планировок квартир. Данные были собраны, размечены и обработаны собственноручно в рамках ВКР.

### Данные
Данные представляют собой изображение планировки квартиры, сегментационную маску комнат и сегментационную маску границ квартиры.
Для сверхбыстрого обучения были взято около 20 изображений. Полный обучающий датасет состоит из более 400 размеченных изображений.

### Подготовка к запуску проекта

1. Создать и активировать новый env с помощью conda с версией python = 3.10:
```bash
conda create --name floor_plan python=3.10
```

2. Загрузить зависимости с помощью poetry:
```bash
poetry install --no-root
```

3. (Опционально) Настроить pre-commit:
```bash
pre-commit install
```
```bash
pre-commit run -a
```

5. Запустить скрипт обучения или валидации с параметрами по умолчанию:
```bash
python3 train.py
```
или
```bash
python3 infer.py
```

### Обучение
При каждом запуске train.py осуществляется загрузка всех необходимых данных с помощью DVC, поэтому при первом запуске необходимо дождаться полной загрузки в течение нескольких минут.
Все гиперпараметры обучения, детали логирования, предобработки данных указываются через конфигурационные файлы .yaml. По умолчанию используется default.yaml. Для обучения
с конкретным конфигом необходимо указать его при запуске:
```bash
python3 train.py --config-name your_config
```

### Предсказание и сбор метрик
infer.py делает предсказания на переданном размеченном датасете и переданных весах модели, считает метрики и записывает их в DVC. Для запуска необходимо указать путь к весам модели,
количество классов комнат и границ, путь к папке размеченного датасета, а также девайс (cpu или cuda, по умолчанию cpu). Результаты сохраняются в соответствующую папку в папке predictions.
```bash
python3 infer.py -h

usage: infer.py [-h] [--weights_path WEIGHTS_PATH] [--room_channels ROOM_CHANNELS] [--boundary_channels BOUNDARY_CHANNELS] [--src_dir SRC_DIR] [--device DEVICE]

options:
  -h, --help            show this help message and exit
  --weights_path WEIGHTS_PATH
  --room_channels ROOM_CHANNELS
  --boundary_channels BOUNDARY_CHANNELS
  --src_dir SRC_DIR
  --device DEVICE
```
